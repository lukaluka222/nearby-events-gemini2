<!doctype html>
<html lang="ja">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>先輩の人生マップ</title>
<style>
  :root{
    --bg:#fffcf6; --ink:#1e293b; --muted:#6b7280;
    --card:#ffffff; --border:#eef2f7; --accent:#6b8cff;
    --purple:#a78bfa; --gray:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 -apple-system,system-ui,Segoe UI,Roboto}
  header{position:sticky;top:0;background:linear-gradient(#fff,rgba(255,255,255,.9));
    backdrop-filter:saturate(1.2) blur(6px);padding:12px 16px;border-bottom:1px solid var(--border)}
  .title{font-weight:700}
  .wrap{max-width:420px;margin:0 auto;padding:12px}
  .canvas{position:relative;aspect-ratio:9/16;background:linear-gradient(180deg,#fff 0%, #fffaf3 100%);
    border:1px solid var(--border);border-radius:16px;overflow:hidden;box-shadow:0 6px 16px rgba(0,0,0,.06)}
  svg{position:absolute;inset:0}
  .node{position:absolute;transform:translate(-50%,-50%);width:84px}
  .dot{width:24px;height:24px;border-radius:50%;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.15)}
  .bubble{margin-top:8px;background:var(--card);border:1px solid var(--border);border-radius:12px;padding:8px;
    font-size:13px;box-shadow:0 4px 12px rgba(0,0,0,.05)}
  .dot.purple{background:var(--purple)}
  .dot.gray{background:var(--gray)}
  .legend{display:flex;gap:8px;align-items:center;color:var(--muted);font-size:12px;margin:8px 0}
  .legend .sw{width:12px;height:12px;border-radius:50%}
  /* モーダル */
  dialog{border:none;border-radius:16px;max-width:520px;width:92vw;padding:0;box-shadow:0 20px 60px rgba(0,0,0,.25)}
  dialog::backdrop{background:rgba(0,0,0,.25)}
  .modal-h{padding:14px 16px;border-bottom:1px solid var(--border);font-weight:700}
  .modal-b{padding:16px}
  .btn{background:var(--accent);color:#fff;border:none;border-radius:12px;padding:10px 14px;font-weight:700}
</style>

<header><div class="title">るかさんの人生マップ（見本）</div></header>
<div class="wrap">
  <div class="canvas" id="canvas">
    <!-- 背景のS字パス（見た目用） -->
    <svg viewBox="0 0 390 700" preserveAspectRatio="xMidYMid meet">
      <defs>
        <filter id="soft"><feGaussianBlur in="SourceGraphic" stdDeviation="3" /></filter>
      </defs>
      <path id="track" d="M40,40 C180,20 210,120 350,100
                           C210,130 180,240 40,220
                           C180,260 210,360 350,340
                           C210,380 180,480 40,460
                           C180,500 210,600 350,580" 
            fill="none" stroke="#efe6ff" stroke-width="28" filter="url(#soft)"/>
      <path d="M40,40 C180,20 210,120 350,100
               C210,130 180,240 40,220
               C180,260 210,360 350,340
               C210,380 180,480 40,460
               C180,500 210,600 350,580" 
            fill="none" stroke="#e9ecff" stroke-width="10" />
    </svg>
    <!-- ここにJSで10コマを配置 -->
  </div>

  <div class="legend">
    <span class="sw" style="background:#a78bfa"></span>強調コマ
    <span class="sw" style="background:#e5e7eb;margin-left:12px"></span>通常コマ
  </div>
</div>

<dialog id="dlg">
  <div class="modal-h" id="dlgTitle">詳細</div>
  <div class="modal-b" id="dlgBody"></div>
  <div style="padding:12px 16px;border-top:1px solid var(--border);text-align:right">
    <button onclick="dlg.close()">閉じる</button>
  </div>
</dialog>


 <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, getDocs, query, orderBy } 
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDA1g7BFkCNJzWfedaAwpkLX_MypeQBA-Q",
    authDomain: "futoko-1f0db.firebaseapp.com",
    projectId: "futoko-1f0db"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // URLから mentorId を取得
  const params = new URLSearchParams(location.search);
  const mentorId = params.get("id");

  // Firestoreからstepsを取得
  const q = query(collection(db, "mentors", mentorId, "steps"), orderBy("step"));
  const snap = await getDocs(q);
  const steps = snap.docs.map(d => d.data());

  // ここから下は「双六UIを描画するコード」に steps を渡せばOK
  // （ダミーデータを使っていた部分を置き換え）
  steps.forEach((s, i) => {
    // パスに沿って配置する処理は既存コードそのまま
  });
</script>

</html>
